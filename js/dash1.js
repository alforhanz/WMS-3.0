var dataPedidos = [
    {
        "ITEM": "1",
        "DOCUMENTO": "T06-00018348",
        "PEDIDO": "P06-10105684",
        "DESCRIPCION": "/ ECONORED DE PANAMA, S.A. .... 01/23/26  2:06:46 PM ",
        "CLIENTE": "ECONORED DE PANAMA, S.A.",
        "TOTAL_UNIDADES": "7.00000000",
        "LINEAS_VERIFICADAS": ".00",
        "LINEAS_PREPARADAS": 0,
        "ESTADO_PEDIDO": "F",
        "USUARIO": "KEVIMOJI",
        "FECHA_FACTURA": "2026-01-28 15:54:50.000",
        "FECHA_PEDIDO": "2026-01-23 00:00:00.000",
        "MODULO": "P",
        "CIA": "B",
        "placa": null,
        "tiene_servicio": "S",
        "SOLICITA": null,
        "ATENDIDO_POR": "Kevin Mojica",
        "FECHA": "2026-01-28 15:54:50.000",
        "ESTADO_PREPARACION": "0"
    },
    {
        "ITEM": "2",
        "DOCUMENTO": "T06-00018340",
        "PEDIDO": "P06-10105454",
        "DESCRIPCION": "SUPREME SERVICES , (PANAMA)N*3,SA  .... 01/17/26  8:23:58 AM ",
        "CLIENTE": "SUPREME SERVICES , (PANAMA)N*3,SA ",
        "TOTAL_UNIDADES": "8.00000000",
        "LINEAS_VERIFICADAS": ".00",
        "LINEAS_PREPARADAS": 0,
        "ESTADO_PEDIDO": "F",
        "USUARIO": "KEVIMOJI",
        "FECHA_FACTURA": "2026-01-28 12:55:52.000",
        "FECHA_PEDIDO": "2026-01-17 00:00:00.000",
        "MODULO": "P",
        "CIA": "B",
        "placa": null,
        "tiene_servicio": "S",
        "SOLICITA": null,
        "ATENDIDO_POR": "Kevin Mojica",
        "FECHA": "2026-01-28 12:55:52.000",
        "ESTADO_PREPARACION": "0"
    },
    {
        "ITEM": "3",
        "DOCUMENTO": "F06-00080477",
        "PEDIDO": "P06-10105516",
        "DESCRIPCION": "MAURO SERVI .... 01/19/26  2:33:11 PM ",
        "CLIENTE": "MAURO SERVI",
        "TOTAL_UNIDADES": "2.00000000",
        "LINEAS_VERIFICADAS": ".00",
        "LINEAS_PREPARADAS": 0,
        "ESTADO_PEDIDO": "F",
        "USUARIO": "KEVIMOJI",
        "FECHA_FACTURA": "2026-01-23 13:06:12.000",
        "FECHA_PEDIDO": "2026-01-19 00:00:00.000",
        "MODULO": "P",
        "CIA": "B",
        "placa": null,
        "tiene_servicio": "N",
        "SOLICITA": null,
        "ATENDIDO_POR": "Kevin Mojica",
        "FECHA": "2026-01-23 13:06:12.000",
        "ESTADO_PREPARACION": "0"
    },
    {
        "ITEM": "4",
        "DOCUMENTO": "T06-00018197",
        "PEDIDO": "P06-10105573",
        "DESCRIPCION": "/ / / TRANSPORTES SPIEGEL, S.A. .... 01/21/26 11:44:07 AM ",
        "CLIENTE": "TRANSPORTES SPIEGEL, S.A.",
        "TOTAL_UNIDADES": "2.00000000",
        "LINEAS_VERIFICADAS": "2.00",
        "LINEAS_PREPARADAS": 0,
        "ESTADO_PEDIDO": "F",
        "USUARIO": "KEVIMOJI",
        "FECHA_FACTURA": "2026-01-22 13:38:33.000",
        "FECHA_PEDIDO": "2026-01-21 00:00:00.000",
        "MODULO": "P",
        "CIA": "B",
        "placa": null,
        "tiene_servicio": "S",
        "SOLICITA": "S",
        "ATENDIDO_POR": "Kevin Mojica",
        "FECHA": "2026-01-22 13:38:33.000",
        "ESTADO_PREPARACION": "G"
    },
    {
        "ITEM": "5",
        "DOCUMENTO": "F06-00080435",
        "PEDIDO": "P06-10105446",
        "DESCRIPCION": "/ DIAZ , GUSTAVO  .... 01/16/26  3:31:22 PM ",
        "CLIENTE": "DIAZ , GUSTAVO ",
        "TOTAL_UNIDADES": "4.00000000",
        "LINEAS_VERIFICADAS": ".00",
        "LINEAS_PREPARADAS": 0,
        "ESTADO_PEDIDO": "F",
        "USUARIO": "KEVIMOJI",
        "FECHA_FACTURA": "2026-01-22 13:20:20.000",
        "FECHA_PEDIDO": "2026-01-16 00:00:00.000",
        "MODULO": "P",
        "CIA": "B",
        "placa": null,
        "tiene_servicio": "N",
        "SOLICITA": null,
        "ATENDIDO_POR": "Kevin Mojica",
        "FECHA": "2026-01-22 13:20:20.000",
        "ESTADO_PREPARACION": "0"
    },
    {
        "ITEM": "6",
        "DOCUMENTO": "T06-00018208",
        "PEDIDO": "P06-10105439",
        "DESCRIPCION": "/ CARDENAS , JOSE  .... 01/16/26  2:32:44 PM ",
        "CLIENTE": "CARDENAS , JOSE ",
        "TOTAL_UNIDADES": "8.00000000",
        "LINEAS_VERIFICADAS": "8.00",
        "LINEAS_PREPARADAS": 0,
        "ESTADO_PEDIDO": "F",
        "USUARIO": "KEVIMOJI",
        "FECHA_FACTURA": "2026-01-21 17:00:57.000",
        "FECHA_PEDIDO": "2026-01-16 00:00:00.000",
        "MODULO": "P",
        "CIA": "B",
        "placa": null,
        "tiene_servicio": "S",
        "SOLICITA": null,
        "ATENDIDO_POR": "Kevin Mojica",
        "FECHA": "2026-01-21 17:00:57.000",
        "ESTADO_PREPARACION": "G"
    },
    {
        "ITEM": "7",
        "DOCUMENTO": "T06-00018141",
        "PEDIDO": "P06-10105364",
        "DESCRIPCION": "/ AGUILAR  , YAJAIRA  .... 01/13/26  4:23:17 PM ",
        "CLIENTE": "AGUILAR  , YAJAIRA ",
        "TOTAL_UNIDADES": "9.00000000",
        "LINEAS_VERIFICADAS": "8.00",
        "LINEAS_PREPARADAS": 0,
        "ESTADO_PEDIDO": "F",
        "USUARIO": "NATAGOME",
        "FECHA_FACTURA": "2026-01-17 15:14:05.000",
        "FECHA_PEDIDO": "2026-01-13 00:00:00.000",
        "MODULO": "P",
        "CIA": "B",
        "placa": "CB0514",
        "tiene_servicio": "S",
        "SOLICITA": null,
        "ATENDIDO_POR": "Natalie S. Gomez",
        "FECHA": "2026-01-17 15:14:05.000",
        "ESTADO_PREPARACION": "G"
    },
    {
        "ITEM": "8",
        "DOCUMENTO": "T06-00018139",
        "PEDIDO": "P06-10105478",
        "DESCRIPCION": "/ BELKIS .... 01/17/26 12:11:07 PM ",
        "CLIENTE": "BELKIS",
        "TOTAL_UNIDADES": "2.00000000",
        "LINEAS_VERIFICADAS": "2.00",
        "LINEAS_PREPARADAS": 0,
        "ESTADO_PEDIDO": "F",
        "USUARIO": "KEVIMOJI",
        "FECHA_FACTURA": "2026-01-17 13:04:43.000",
        "FECHA_PEDIDO": "2026-01-17 00:00:00.000",
        "MODULO": "P",
        "CIA": "B",
        "placa": null,
        "tiene_servicio": "S",
        "SOLICITA": null,
        "ATENDIDO_POR": "Kevin Mojica",
        "FECHA": "2026-01-17 13:04:43.000",
        "ESTADO_PREPARACION": "G"
    },
    {
        "ITEM": "9",
        "DOCUMENTO": "T06-00018138",
        "PEDIDO": "P06-10105477",
        "DESCRIPCION": "/ / LA SANT√â .... 01/17/26 12:03:49 PM ",
        "CLIENTE": "LA SANT√â",
        "TOTAL_UNIDADES": "4.00000000",
        "LINEAS_VERIFICADAS": "4.00",
        "LINEAS_PREPARADAS": 0,
        "ESTADO_PEDIDO": "F",
        "USUARIO": "KEVIMOJI",
        "FECHA_FACTURA": "2026-01-17 13:04:11.000",
        "FECHA_PEDIDO": "2026-01-17 00:00:00.000",
        "MODULO": "P",
        "CIA": "B",
        "placa": null,
        "tiene_servicio": "S",
        "SOLICITA": null,
        "ATENDIDO_POR": "Kevin Mojica",
        "FECHA": "2026-01-17 13:04:11.000",
        "ESTADO_PREPARACION": "G"
    },
    {
        "ITEM": "10",
        "DOCUMENTO": "T06-00017990",
        "PEDIDO": "P06-10105194",
        "DESCRIPCION": "/ / / / CENTRAL DE LUBRICANTES, S.A. .... 01/07/26  2:03:26 PM ",
        "CLIENTE": "CENTRAL DE LUBRICANTES, S.A.",
        "TOTAL_UNIDADES": "16.00000000",
        "LINEAS_VERIFICADAS": ".00",
        "LINEAS_PREPARADAS": 0,
        "ESTADO_PEDIDO": "F",
        "USUARIO": "NATAGOME",
        "FECHA_FACTURA": "2026-01-16 11:49:16.000",
        "FECHA_PEDIDO": "2026-01-07 00:00:00.000",
        "MODULO": "P",
        "CIA": "B",
        "placa": "BS4339",
        "tiene_servicio": "S",
        "SOLICITA": null,
        "ATENDIDO_POR": "Natalie S. Gomez",
        "FECHA": "2026-01-16 11:49:16.000",
        "ESTADO_PREPARACION": "0"
    },
    {
        "ITEM": "11",
        "DOCUMENTO": "F06-00080284",
        "PEDIDO": "P06-10105238",
        "DESCRIPCION": "/ JUNTA COMUNAL DE LAS GARZAS .... 01/08/26  1:11:24 PM ",
        "CLIENTE": "JUNTA COMUNAL DE LAS GARZAS",
        "TOTAL_UNIDADES": "4.00000000",
        "LINEAS_VERIFICADAS": ".00",
        "LINEAS_PREPARADAS": 0,
        "ESTADO_PEDIDO": "F",
        "USUARIO": "KEVIMOJI",
        "FECHA_FACTURA": "2026-01-16 11:45:36.000",
        "FECHA_PEDIDO": "2026-01-08 00:00:00.000",
        "MODULO": "P",
        "CIA": "B",
        "placa": null,
        "tiene_servicio": "N",
        "SOLICITA": null,
        "ATENDIDO_POR": "Kevin Mojica",
        "FECHA": "2026-01-16 11:45:36.000",
        "ESTADO_PREPARACION": "0"
    },
    {
        "ITEM": "12",
        "DOCUMENTO": "T06-00018023",
        "PEDIDO": "P06-10105268",
        "DESCRIPCION": "/ / SANCHEZPE , PEDRO WILIAN .... 01/10/26  9:38:32 AM ",
        "CLIENTE": "SANCHEZPE , PEDRO WILIAN",
        "TOTAL_UNIDADES": "6.00000000",
        "LINEAS_VERIFICADAS": "3.00",
        "LINEAS_PREPARADAS": 0,
        "ESTADO_PEDIDO": "F",
        "USUARIO": "KEVIMOJI",
        "FECHA_FACTURA": "2026-01-16 08:17:58.000",
        "FECHA_PEDIDO": "2026-01-10 00:00:00.000",
        "MODULO": "P",
        "CIA": "B",
        "placa": null,
        "tiene_servicio": "N",
        "SOLICITA": null,
        "ATENDIDO_POR": "Kevin Mojica",
        "FECHA": "2026-01-16 08:17:58.000",
        "ESTADO_PREPARACION": "G"
    },
    {
        "ITEM": "13",
        "DOCUMENTO": "F06-00080229",
        "PEDIDO": "P06-10105201",
        "DESCRIPCION": "/ / PANAMCO, INC .... 01/07/26  3:35:24 PM ",
        "CLIENTE": "PANAMCO, INC",
        "TOTAL_UNIDADES": "4.00000000",
        "LINEAS_VERIFICADAS": ".00",
        "LINEAS_PREPARADAS": 0,
        "ESTADO_PEDIDO": "F",
        "USUARIO": "KEVIMOJI",
        "FECHA_FACTURA": "2026-01-13 15:39:01.000",
        "FECHA_PEDIDO": "2026-01-07 00:00:00.000",
        "MODULO": "P",
        "CIA": "B",
        "placa": null,
        "tiene_servicio": "N",
        "SOLICITA": null,
        "ATENDIDO_POR": "Kevin Mojica",
        "FECHA": "2026-01-13 15:39:01.000",
        "ESTADO_PREPARACION": "0"
    },
    {
        "ITEM": "14",
        "DOCUMENTO": "T06-00018005",
        "PEDIDO": "P06-10105225",
        "DESCRIPCION": "/ CHAVEZ , VENACIO /APARTADO .... 01/08/26 10:48:21 AM ",
        "CLIENTE": "CHAVEZ , VENACIO /APARTADO",
        "TOTAL_UNIDADES": "8.00000000",
        "LINEAS_VERIFICADAS": ".00",
        "LINEAS_PREPARADAS": 0,
        "ESTADO_PEDIDO": "F",
        "USUARIO": "KEVIMOJI",
        "FECHA_FACTURA": "2026-01-08 10:49:24.000",
        "FECHA_PEDIDO": "2026-01-08 00:00:00.000",
        "MODULO": "P",
        "CIA": "B",
        "placa": "EK9415",
        "tiene_servicio": "S",
        "SOLICITA": null,
        "ATENDIDO_POR": "Kevin Mojica",
        "FECHA": "2026-01-08 10:49:24.000",
        "ESTADO_PREPARACION": "0"
    },
    {
        "ITEM": "15",
        "DOCUMENTO": "T06-00017974",
        "PEDIDO": "P06-10105153",
        "DESCRIPCION": "/ GONZALEZ , DENIA  .... 01/06/26  2:06:13 PM ",
        "CLIENTE": "GONZALEZ , DENIA ",
        "TOTAL_UNIDADES": "8.00000000",
        "LINEAS_VERIFICADAS": ".00",
        "LINEAS_PREPARADAS": 0,
        "ESTADO_PEDIDO": "F",
        "USUARIO": "KEVIMOJI",
        "FECHA_FACTURA": "2026-01-06 15:06:07.000",
        "FECHA_PEDIDO": "2026-01-06 00:00:00.000",
        "MODULO": "P",
        "CIA": "B",
        "placa": null,
        "tiene_servicio": "S",
        "SOLICITA": null,
        "ATENDIDO_POR": "Kevin Mojica",
        "FECHA": "2026-01-06 15:06:07.000",
        "ESTADO_PREPARACION": "0"
    },
    {
        "ITEM": "16",
        "DOCUMENTO": "F06-00080072",
        "PEDIDO": "P06-10105147",
        "DESCRIPCION": "/ SOLIS, JOSE .... 01/06/26 12:05:41 PM ",
        "CLIENTE": "SOLIS, JOSE",
        "TOTAL_UNIDADES": "4.00000000",
        "LINEAS_VERIFICADAS": ".00",
        "LINEAS_PREPARADAS": 0,
        "ESTADO_PEDIDO": "F",
        "USUARIO": "KEVIMOJI",
        "FECHA_FACTURA": "2026-01-06 12:06:39.000",
        "FECHA_PEDIDO": "2026-01-06 00:00:00.000",
        "MODULO": "P",
        "CIA": "B",
        "placa": null,
        "tiene_servicio": "N",
        "SOLICITA": null,
        "ATENDIDO_POR": "Kevin Mojica",
        "FECHA": "2026-01-06 12:06:39.000",
        "ESTADO_PREPARACION": "0"
    },
    {
        "ITEM": "17",
        "DOCUMENTO": "T06-00017951",
        "PEDIDO": "P06-10105095",
        "DESCRIPCION": "PRONTO ASEO, S.A. .... 01/05/26 11:29:52 AM ",
        "CLIENTE": "PRONTO ASEO, S.A.",
        "TOTAL_UNIDADES": "4.00000000",
        "LINEAS_VERIFICADAS": ".00",
        "LINEAS_PREPARADAS": 0,
        "ESTADO_PEDIDO": "F",
        "USUARIO": "KEVIMOJI",
        "FECHA_FACTURA": "2026-01-05 15:10:15.000",
        "FECHA_PEDIDO": "2026-01-05 00:00:00.000",
        "MODULO": "P",
        "CIA": "B",
        "placa": null,
        "tiene_servicio": "S",
        "SOLICITA": null,
        "ATENDIDO_POR": "Kevin Mojica",
        "FECHA": "2026-01-05 15:10:15.000",
        "ESTADO_PREPARACION": "0"
    },
    {
        "ITEM": "18",
        "DOCUMENTO": "T06-00017901",
        "PEDIDO": "P06-10105019",
        "DESCRIPCION": "/ CENTRAL DE LUBRICANTES, S.A. .... 01/02/26  3:04:45 PM ",
        "CLIENTE": "CENTRAL DE LUBRICANTES, S.A.",
        "TOTAL_UNIDADES": "10.00000000",
        "LINEAS_VERIFICADAS": "10.00",
        "LINEAS_PREPARADAS": 0,
        "ESTADO_PEDIDO": "F",
        "USUARIO": "KEVIMOJI",
        "FECHA_FACTURA": "2026-01-05 13:26:38.000",
        "FECHA_PEDIDO": "2026-01-02 00:00:00.000",
        "MODULO": "P",
        "CIA": "B",
        "placa": "639393",
        "tiene_servicio": "S",
        "SOLICITA": null,
        "ATENDIDO_POR": "Kevin Mojica",
        "FECHA": "2026-01-05 13:26:38.000",
        "ESTADO_PREPARACION": "G"
    }
];


// Configuraci√≥n Global para estilo DARK en Chart.js
Chart.defaults.color = '#8b949e'; // Color de texto
Chart.defaults.borderColor = '#30363d'; // Color de l√≠neas de divisi√≥n
document.addEventListener("DOMContentLoaded", function () {
    localStorage.clear();
    $(".dropdown-trigger").dropdown();
    //getDataDash();
    //cargarBodegas();
     renderizarDashboardWMS();
 actualizarKpisConDatosReales(dataPedidos) 

});
// function cargarBodegas() {
//   fetch(env.API_URL + "wmsmostarbodegasconsultaordencompra")
//     .then((response) => response.json())
//     .then((data) => {
//       const bodegasSelect = document.getElementById("select_bodegas");
//       if (data.respuesta && Array.isArray(data.respuesta)) {
//         // Limpiar las opciones existentes
//         bodegasSelect.innerHTML =
//           '<option value="" disabled selected>Seleccione una bodega</option>';

//         // Agregar opciones nuevas
//         data.respuesta.forEach((bodega) => {
//           const option = document.createElement("option");
//           option.value = bodega.BODEGA;
//           option.textContent = bodega.NOMBRE;
//           bodegasSelect.appendChild(option);
//         });

//         // Re-inicializar el select para aplicar los cambios
//         M.FormSelect.init(bodegasSelect);
//       } else {
//         console.error("No se encontraron bodegas.");
//       }
//     })
//     .catch((error) => console.error("Error al cargar las bodegas:", error));
// }
// Escuchar el cambio de bodega para filtrar el Dashboard
document.getElementById("bodega").addEventListener('change', function() {
    const bodegaSeleccionada = this.value;
    console.log("Filtrando datos para: " + bodegaSeleccionada);
    // Aqu√≠ llamar√≠as a tu funci√≥n de actualizaci√≥n de datos: 
    actualizarDashboard(bodegaSeleccionada);
});
// ... Mantener funciones similares para OC llamando a mostrarGraficas con t√≠tulos personalizados
Chart.defaults.color = '#8b949e';
Chart.defaults.borderColor = '#30363d';
document.addEventListener("DOMContentLoaded", function () {
                M.AutoInit();
               // cargarBodegas();
                renderizarDashboardWMS();
                });
/**
 * @function renderizarDashboardWMS
 * @description Renderiza cada segmento del dashboard y las graficas. 
 */
function renderizarDashboardWMS() {
    // 1. Gr√°fica de Barras: Estado de Pedidos (Pendiente, En Picking, Empacado, Despachado)
    new Chart(document.getElementById('chartStatus'), {
        type: 'bar',
        data: {
            labels: ['Pendiente', 'Facturados', 'Orden de Taller', 'Despachado'],
            datasets: [{
                label: 'Cantidad de Pedidos',
                data: [450, 320, 280, 890],
                backgroundColor: '#00ced1',
                borderRadius: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } }
        }
    });

    // 2. Gr√°fica de Dona: Ocupaci√≥n de Bodega por Tipo de Producto o Zona
    new Chart(document.getElementById('chartZonas'), {
        type: 'pie',
        data: {
            labels: ['Rack A (Llantas)', 'Rack B (Aceites)', 'Rines', 'Filtros'],
            datasets: [{
                data: [40, 15, 25, 20],
                backgroundColor: ['#008080', '#2a9d8f', '#e9c46a', '#f4a261'],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            //cutout: '75%',
            plugins: { legend: { position: 'bottom' } }
        }
    });

    // 3. Gr√°fica Lineal: Productividad de Preparaci√≥n (Picking vs Packing)
    new Chart(document.getElementById("chartProductividad"), {
      type: "line",
      data: {
        labels: ["08:00", "10:00", "12:00", "14:00", "16:00", "18:00"],
        datasets: [
          {
            label: "Picking Contenedores",
            data: [120, 250, 180, 300, 450, 200],
            borderColor: "#00ced1",
            tension: 0.4,
            fill: false,
          },
          {
            label: "Contenedores Pendientes",
            data: [80, 210, 150, 260, 400, 350],
            borderColor: "#f07167",
            tension: 0.4,
            fill: false,
          },
        ],
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { position: "bottom" } },
      },
    });
// --- NUEVO 4. GR√ÅFICO DE TRANSACCIONES (DIN√ÅMICO) ---
const transacciones = [
    { "CONSECUTIVO DESTINO": "FAC#F01-00789543", "CANT CONTADA": null, "CANT VERIFICADA": null, "CANT APLICADA": "1.00", "TIPO_TRANSACCION": "Pedidos" },
    { "CONSECUTIVO DESTINO": "FAC#F01-00789544", "CANT CONTADA": null, "CANT VERIFICADA": null, "CANT APLICADA": "1.00", "TIPO_TRANSACCION": "Pedidos" },
    { "CONSECUTIVO DESTINO": "FAC#F01-00789545", "CANT CONTADA": "1.00", "CANT VERIFICADA": null, "CANT APLICADA": "1.00", "TIPO_TRANSACCION": "Pedidos" },
    { "CONSECUTIVO DESTINO": "FAC#F01-00789545", "CANT CONTADA": null, "CANT VERIFICADA": null, "CANT APLICADA": "1.00", "TIPO_TRANSACCION": "Pedidos" },
    { "CONSECUTIVO DESTINO": "TRAS01-00063634", "CANT CONTADA": null, "CANT VERIFICADA": null, "CANT APLICADA": "16.00", "TIPO_TRANSACCION": "Traslados" },
    { "CONSECUTIVO DESTINO": "FAC#F01-00790169", "CANT CONTADA": "1.00", "CANT VERIFICADA": null, "CANT APLICADA": "1.00", "TIPO_TRANSACCION": "Pedidos" },
    { "CONSECUTIVO DESTINO": "TRAS01-00063668", "CANT CONTADA": null, "CANT VERIFICADA": null, "CANT APLICADA": "4.00", "TIPO_TRANSACCION": "Traslados" },
    { "CONSECUTIVO DESTINO": "TRAS01-00063668", "CANT CONTADA": null, "CANT VERIFICADA": null, "CANT APLICADA": "12.00", "TIPO_TRANSACCION": "Traslados" },
    { "CONSECUTIVO DESTINO": "TRAS01-00063668", "CANT CONTADA": null, "CANT VERIFICADA": null, "CANT APLICADA": "8.00", "TIPO_TRANSACCION": "Traslados" },
    { "CONSECUTIVO DESTINO": "TRAS01-00063668", "CANT CONTADA": null, "CANT VERIFICADA": null, "CANT APLICADA": "4.00", "TIPO_TRANSACCION": "Traslados" },
    { "CONSECUTIVO DESTINO": "TRAS01-00063668", "CANT CONTADA": null, "CANT VERIFICADA": null, "CANT APLICADA": "4.00", "TIPO_TRANSACCION": "Traslados" },
    { "CONSECUTIVO DESTINO": "TRAS01-00063659", "CANT CONTADA": null, "CANT VERIFICADA": null, "CANT APLICADA": "4.00", "TIPO_TRANSACCION": "Traslados" },
    { "CONSECUTIVO DESTINO": "TRAS01-00063659", "CANT CONTADA": null, "CANT VERIFICADA": null, "CANT APLICADA": "24.00", "TIPO_TRANSACCION": "Traslados" },
    { "CONSECUTIVO DESTINO": "Embarque EM00036454", "CANT CONTADA": null, "CANT VERIFICADA": 0, "CANT APLICADA": "2.00", "TIPO_TRANSACCION": "Compras" },
    { "CONSECUTIVO DESTINO": "Embarque EM00036454", "CANT CONTADA": null, "CANT VERIFICADA": 0, "CANT APLICADA": "2.00", "TIPO_TRANSACCION": "Compras" },
    { "CONSECUTIVO DESTINO": "Embarque EM00036454", "CANT CONTADA": null, "CANT VERIFICADA": 0, "CANT APLICADA": "2.00", "TIPO_TRANSACCION": "Compras" },
    { "CONSECUTIVO DESTINO": "Embarque EM00036454", "CANT CONTADA": null, "CANT VERIFICADA": 0, "CANT APLICADA": "2.00", "TIPO_TRANSACCION": "Compras" },
    { "CONSECUTIVO DESTINO": "Embarque EM00036454", "CANT CONTADA": null, "CANT VERIFICADA": 0, "CANT APLICADA": "2.00", "TIPO_TRANSACCION": "Compras" }
];

// 1. Definimos los labels exactos que queremos ver en el eje Y
const tipos = ["Pedidos", "Traslados", "Ordenes de Compras"];
let finalizados = [0, 0, 0]; 
let pendientes = [0, 0, 0];

transacciones.forEach(item => {
    // Mapeo: "Compras" en el JSON -> "Ordenes de Compras" en el gr√°fico
    let tipoJson = item.TIPO_TRANSACCION;
    if (tipoJson === "Compras") tipoJson = "Ordenes de Compras";

    const index = tipos.indexOf(tipoJson);
    
    if (index !== -1) {
        const cant = parseFloat(item["CANT APLICADA"]) || 0;
        // L√≥gica de estado
        if (item["CANT CONTADA"] > 0 || item["CANT VERIFICADA"] > 0) {
            finalizados[index] += cant;
        } else {
            pendientes[index] += cant;
        }
    }
});

new Chart(document.getElementById("chartArticulos"), {
    type: "bar",
    data: {
        labels: tipos, // Aqu√≠ aparecer√°n Pedidos, Traslados, etc.
        datasets: [
            {
                label: "Finalizados",
                data: finalizados,
                backgroundColor: "#00ced1", // Teal
                borderRadius: 5,
            },
            {
                label: "Pendientes",
                data: pendientes,
                backgroundColor: "#f07167", // Coral
                borderRadius: 5,
            },
        ],
    },
    options: {
        indexAxis: 'y', // <--- BARRA ACOSTADA
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            x: { 
                stacked: true, // <--- COMPARATIVO EN LA MISMA BARRA
                grid: { color: "#30363d" },
                ticks: { color: "#fff" } 
            },
            y: { 
                stacked: true, // <--- COMPARATIVO EN LA MISMA BARRA
                grid: { display: false }, 
                ticks: { color: "#fff", font: { size: 12 } } 
            },
        },
        plugins: {
            legend: { 
                position: 'top', 
                labels: { color: "#fff", usePointStyle: true } 
            },
        },
    },
});
// --- FIN NUEVO 4 ----

    // 4. Avance de pedidos (Horizontal)
// new Chart(document.getElementById("chartArticulos"), {
//   type: "bar",
//   data: {
//     labels: ["Lunes", "Martes", "Mi√©rcoles", "Jueves", "Viernes"],
//     datasets: [
//       {
//         label: "Finalizados",
//         data: [120, 150, 180, 90, 200],
//         backgroundColor: "#00ced1", // Teal
//       },
//       {
//         label: "Pendientes",
//         data: [30, 40, 10, 50, 20],
//         backgroundColor: "#f07167", // Rojo/Naranja
//       },
//     ],
//   },
//   options: {
//     indexAxis: 'y', // <--- ESTA ES LA CLAVE PARA EL MODO HORIZONTAL
//     responsive: true,
//     maintainAspectRatio: false,
//     scales: {
//       x: { 
//         stacked: true, 
//         grid: { color: "#30363d" }, 
//         ticks: { color: "#fff" } 
//       },
//       y: { 
//         stacked: true, 
//         grid: { display: false }, // Quitamos la rejilla vertical para que se vea m√°s limpio
//         ticks: { color: "#fff" } 
//       },
//     },
//     plugins: {
//       legend: { 
//         position: 'top', 
//         labels: { color: "#fff" } 
//       },
//     },
//   },
// });

//5. Radar Chart (o gr√°fico de ara√±a).
new Chart(document.getElementById('tuCanvasID'), {
    type: 'radar',
    data: {
        labels: [
            'Velocidad Picking', 
            'Precisi√≥n Inventario', 
            'Tiempo Packing', 
            'Capacidad Despacho', 
            'Seguridad'
        ],
        datasets: [{
            label: 'CEDI Pueblo Nuevo',
            data: [95, 90, 85, 92, 98], // Valores de 0 a 100
            fill: true,
            backgroundColor: 'rgba(0, 206, 209, 0.2)', // Teal transparente
            borderColor: '#00ced1',
            pointBackgroundColor: '#00ced1',
            pointBorderColor: '#fff',
            pointHoverBackgroundColor: '#fff',
            pointHoverBorderColor: '#00ced1'
        }, {
            label: 'Sucursal David',
            data: [70, 85, 60, 75, 90],
            fill: true,
            backgroundColor: 'rgba(240, 113, 103, 0.2)', // Rojo transparente
            borderColor: '#f07167',
            pointBackgroundColor: '#f07167',
            pointBorderColor: '#fff',
            pointHoverBackgroundColor: '#fff',
            pointHoverBorderColor: '#f07167'
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            r: {
                angleLines: { color: '#30363d' }, // L√≠neas radiales
                grid: { color: '#30363d' },      // C√≠rculos de fondo
                pointLabels: { color: '#fff', font: { size: 12 } }, // Etiquetas externas
                ticks: { display: false, backdropColor: 'transparent' } // N√∫meros internos
            }
        },
        plugins: {
            legend: {
                labels: { color: '#fff' }
            }
        }
    }
});

    // 5. Gr√°fica Lineal: Articulos m√°s vendidos
    new Chart(document.getElementById("chartContenedores"), {
      type: "polarArea",
      data: {
        labels: ["Rack A", "Rack B", "Rines", "Filtros", "Bater√≠as"],
        datasets: [
          {
            data: [80, 45, 90, 60, 30], // Representa niveles de stock
            backgroundColor: [
              "rgba(0, 206, 209, 0.5)",
              "rgba(42, 157, 143, 0.5)",
              "rgba(233, 196, 106, 0.5)",
              "rgba(244, 162, 97, 0.5)",
              "rgba(240, 113, 103, 0.5)",
            ],
            borderColor: "#fff",
            borderWidth: 1,
          },
        ],
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          r: {
            grid: { color: "#30363d" },
            ticks: { display: false }, // Limpia el dise√±o
          },
        },
        plugins: {
          legend: { position: "right", labels: { color: "#fff" } },
        },
      },
    });
}
// Escuchar cambios en el select de bodegas
// document.getElementById("select_bodegas").addEventListener('change', function() {
document.getElementById("bodega").addEventListener('change', function() {
    console.log("Cambiando datos para bodega: " + this.value);
    // Aqu√≠ podr√≠as disparar un fetch a tu API enviando el ID de la bodega
    // updateDashWithRealData(this.value);
});
// function cargarBodegas() {
//     const bodegasSelect = document.getElementById("select_bodegas");
//     fetch(env.API_URL + "wmsmostarbodegasconsultaordencompra")
//         .then(res => res.json())
//         .then(data => {
//             if (data.respuesta) {
//                 bodegasSelect.innerHTML = '<option value="" disabled selected>Seleccione una bodega</option>';
//                 data.respuesta.forEach(b => {
//                     const opt = new Option(b.NOMBRE, b.BODEGA);
//                     bodegasSelect.add(opt);
//                 });
//                 M.FormSelect.init(bodegasSelect);
//             }
//         }).catch(err => console.error("Error al cargar bodegas:", err));
// }
function initMapaPanama() {
    const mapContainer = document.getElementById('mapPanama');
    if (!mapContainer) return;

    const map = L.map('mapPanama').setView([8.538, -80.782], 7);

    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; OpenStreetMap'
    }).addTo(map);

    const bodegas = [
        // --- GRUPO BREMEN ---
        { id: "BR-TM", nombre: "Bremen - Tumba Muerto", coords: [9.0251, -79.5226], tipo: "Bremen", gmaps: "https://maps.google.com/?cid=10079881889526052492&g_mp=Cidnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLlNlYXJjaFRleHQ" },
        { id: "BR-C50", nombre: "Bremen - Calle 50", coords: [8.9885, -79.5127], tipo: "Bremen", gmaps: "https://maps.google.com/?cid=1277513250532887642&g_mp=Cidnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLlNlYXJjaFRleHQ" },
        { id: "BR-24D", nombre: "Bremen - 24 de Diciembre", coords: [9.1013, -79.3854], tipo: "Bremen", gmaps: "https://maps.google.com/?cid=11913408935496564016&g_mp=Cidnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLlNlYXJjaFRleHQ" },
        { id: "BR-DAV", nombre: "Bremen - David", coords: [8.4238, -82.4323], tipo: "Bremen", gmaps: "https://maps.google.com/?cid=14462542309345647693&g_mp=Cidnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLlNlYXJjaFRleHQ" },
        { id: "BR-CHI", nombre: "Bremen - Chitr√©", coords: [7.9600, -80.4297], tipo: "Bremen", gmaps: "https://maps.google.com/?cid=13706581016572968707&g_mp=Cidnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLlNlYXJjaFRleHQ" },
        { id: "BR-SAN", nombre: "Bremen - Santiago", coords: [8.1046, -80.9701], tipo: "Bremen", gmaps: "https://maps.google.com/?cid=14334376120144714680&g_mp=Cidnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLlNlYXJjaFRleHQ" },
        { id: "BR-PEN", nombre: "Bremen - Penonom√©", coords: [8.5144, -80.3589], tipo: "Bremen", gmaps: "https://maps.google.com/?cid=10742304592685314903&g_mp=Cidnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLlNlYXJjaFRleHQ" },

        // --- GRUPO NORWING ---
        { id: "CEDI-01", nombre: "CEDI Norwing - Pueblo Nuevo", coords: [9.019268, -79.5131725], tipo: "CEDI", gmaps: "https://www.google.com/maps/search/?api=1&query=9.019268,-79.5131725" },
       // { id: "NW-PN", nombre: "Norwing - Pueblo Nuevo", coords: [9.0192, -79.5131], tipo: "Norwing", gmaps: "https://www.google.com/maps/search/?api=1&query=9.019268,-79.5131725" },
        { id: "NW-PC", nombre: "Norwing - Plaza Carolina", coords: [9.0278, -79.4798], tipo: "Norwing", gmaps: "https://maps.google.com/?cid=1291211260969938617&g_mp=Cidnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLlNlYXJjaFRleHQ" },
        { id: "NW-DAV", nombre: "Norwing - David (San Mateo)", coords: [8.4287, -82.4351], tipo: "Norwing", gmaps: "https://maps.google.com/?cid=7297405406566993614&g_mp=Cidnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLlNlYXJjaFRleHQ" }
    ];

    bodegas.forEach(b => {
        const esCEDI = b.tipo === "CEDI";
        
        // Estilo din√°mico: CEDI resalta m√°s
        const marker = L.circleMarker(b.coords, {
            radius: esCEDI ? 12 : 9,
            fillColor: esCEDI ? "#ff9800" : "#00ced1", // Naranja para CEDI, Teal para sucursales
            color: "#fff",
            weight: 2,
            opacity: 1,
            fillOpacity: 0.8
        }).addTo(map);

        // Popup con ID de WMS y link a Maps
        marker.bindPopup(`
                <div style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: #333; min-width: 200px;">
                    <strong style="font-size: 15px; color: #008b8b;">${b.nombre}</strong><br>
                    <span style="color: #666; font-size: 12px;">ID WMS: <b>${b.id}</b></span><br>
                    <hr style="margin: 10px 0; border: 0; border-top: 1px solid #eee;">
                    
                    <div style="display: flex; flex-direction: column; gap: 5px; font-size: 13px;">
                        <div style="display: flex; justify-content: space-between;">
                            <span>üì¶ <b>Total de Pedidos:</b></span>
                            <span>200</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; color: #2e7d32;">
                            <span>‚úÖ <b>Finalizados:</b></span>
                            <span>50</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; color: #d32f2f;">
                            <span>‚è≥ <b>Pendientes:</b></span>
                            <span>150</span>
                        </div>
                    </div>

                    <a href="${b.gmaps}" target="_blank" style="display: block; margin-top: 12px; padding: 8px; background: #00ced1; color: white; text-align: center; border-radius: 4px; text-decoration: none; font-weight: bold; font-size: 12px;">
                        üìç ABRIR EN GOOGLE MAPS
                    </a>
                </div>
            `);       
    });
}
// Asegurar que se ejecute despu√©s de que cargue el DOM
$(document).ready(function() {
    initMapaPanama();
});
/**
 * Actualiza todos los componentes del dashboard bas√°ndose en la bodega elegida
 * @param {string} idBodega - El ID de la bodega (ej: 'CEDI-01', 'BR-DAV')
 */
function actualizarDashboard(idBodega) {
    console.log("Actualizando dashboard para bodega: " + idBodega);

    // 1. Mostrar un loader si lo tienes (Opcional)
    // if(typeof showLoader === 'function') showLoader();

    // 2. Buscar los datos de la bodega en nuestro array de 'bodegas' 
    // (El que definimos en initMapaPanama)
    const infoBodega = bodegas.find(b => b.id === idBodega);

    if (infoBodega) {
        // --- EFECTO EN EL MAPA ---
        // Volamos a la ubicaci√≥n de la bodega seleccionada con un zoom de 15 (nivel calle/bodega)
        map.flyTo(infoBodega.coords, 15, {
            animate: true,
            duration: 1.5
        });

        // Opcional: Abrir el popup autom√°ticamente
        // L.popup().setLatLng(infoBodega.coords).setContent(`<b>Cargando datos de ${infoBodega.nombre}...</b>`).openOn(map);
    }

    // 3. Simulaci√≥n de Fetch a la API
    // En el futuro, aqu√≠ har√≠as: fetch(env.API_URL + 'GetData?id=' + idBodega)...
    
    // Datos aleatorios para simular el cambio visual inmediato
    const randomTotal = Math.floor(Math.random() * 500) + 100;
    const randomFinal = Math.floor(randomTotal * 0.7);
    const randomPendiente = randomTotal - randomFinal;

    // --- ACTUALIZAR KPIs ---
    document.getElementById('kpi_pedidos').innerText = randomTotal;
    document.getElementById('kpi_items').innerText = (randomTotal * 12.5).toFixed(0); // Simulaci√≥n de √≠tems
    document.getElementById('kpi_pendientes').innerText = randomPendiente;
    
    // --- ACTUALIZAR GR√ÅFICAS ---
    // Importante: Debes tener las variables de tus charts (chartStatus, chartZonas, etc.) 
    // declaradas de forma global para poder acceder a .data y .update()

    if (window.myChartStatus) {
        window.myChartStatus.data.datasets[0].data = [
            randomPendiente, 
            Math.floor(randomPendiente * 0.5), 
            Math.floor(randomFinal * 0.2), 
            randomFinal
        ];
        window.myChartStatus.update();
    }

    if (window.myChartZonas) {
        // Cambiamos proporciones de ocupaci√≥n de racks
        window.myChartZonas.data.datasets[0].data = [
            Math.random() * 50, 
            Math.random() * 50, 
            Math.random() * 50, 
            Math.random() * 50
        ];
        window.myChartZonas.update();
    }

    M.toast({html: `Datos de ${infoBodega ? infoBodega.nombre : idBodega} actualizados`, classes: 'rounded'});
}

function actualizarKpisConDatosReales(data) {
    // 1. Total de Pedidos
    const totalPedidos = data.length;

    // 2. Suma de Art√≠culos (Unidades totales)
    const totalUnidades = data.reduce((acc, curr) => acc + parseFloat(curr.TOTAL_UNIDADES), 0);

    // 3. Eficiencia de Picking (Verificados vs Solicitados)
    const unidadesVerificadas = data.reduce((acc, curr) => acc + parseFloat(curr.LINEAS_VERIFICADAS), 0);
    const eficiencia = totalUnidades > 0 ? (unidadesVerificadas / totalUnidades) * 100 : 0;

    // 4. Pendientes Cr√≠ticos 
    // (Ejemplo: Tienen servicio especial "S" pero estado de preparaci√≥n es "0")
    const criticos = data.filter(p => p.tiene_servicio === "S" && p.ESTADO_PREPARACION === "0").length;

    // --- ACTUALIZAR EL HTML ---
    
    // Pedidos (Formato 18)
    document.getElementById('kpi_pedidos').innerText = totalPedidos;

    // Art√≠culos (Formato 102.0 - Solo unidades enteras si prefieres)
    document.getElementById('kpi_items').innerText = totalUnidades.toFixed(0);

    // Eficiencia (Formato 85.5%)
    document.getElementById('kpi_eficiencia').innerText = eficiencia.toFixed(1) + "%";

    // Pendientes
    document.getElementById('kpi_pendientes').innerText = criticos;

    // Animaci√≥n visual r√°pida para indicar cambio
    $('.kpi-value').fadeOut(100).fadeIn(100);
}
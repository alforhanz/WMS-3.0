// var paquetesCreadosArray = [
//   { TRASLADO: "TRAS81-0000031055", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "06 BREMEN 24 DE DICIEMBRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031053", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "06 BREMEN 24 DE DICIEMBRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031052", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "06 BREMEN 24 DE DICIEMBRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031051", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "06 BREMEN 24 DE DICIEMBRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031050", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "06 BREMEN 24 DE DICIEMBRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031049", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "06 BREMEN 24 DE DICIEMBRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031048", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "06 BREMEN 24 DE DICIEMBRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031047", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "06 BREMEN 24 DE DICIEMBRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031046", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "06 BREMEN 24 DE DICIEMBRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031045", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "06 BREMEN 24 DE DICIEMBRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031044", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "06 BREMEN 24 DE DICIEMBRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031043", USUARIO: "XJULIDIAZ", FECHA: "14/02/2025", BODEGA_DESTINO: "06 BREMEN 24 DE DICIEMBRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031042", USUARIO: "XJULIDIAZ", FECHA: "14/02/2025", BODEGA_DESTINO: "06 BREMEN 24 DE DICIEMBRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031031", USUARIO: "CI/JULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "55 NORWING SANTIAGO", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031030", USUARIO: "CI/JULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "55 NORWING SANTIAGO", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031029", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "55 NORWING SANTIAGO", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031028", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "55 NORWING SANTIAGO", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031027", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "55 NORWING SANTIAGO", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031026", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "55 NORWING SANTIAGO", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031025", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "55 NORWING SANTIAGO", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031024", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "55 NORWING SANTIAGO", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031023", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "55 NORWING SANTIAGO", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031022", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "55 NORWING SANTIAGO", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031017", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "53 NORWING CHITRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031015", USUARIO: "XJULIDIAZ", FECHA: "17/02/2025", BODEGA_DESTINO: "53 NORWING CHITRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031014", USUARIO: "CI/JULIDIAZ", FECHA: "17/02/2025", BODEGA_DESTINO: "53 NORWING CHITRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031013", USUARIO: "CI/JULIDIAZ", FECHA: "17/02/2025", BODEGA_DESTINO: "53 NORWING CHITRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031012", USUARIO: "CI/JULIDIAZ", FECHA: "17/02/2025", BODEGA_DESTINO: "53 NORWING CHITRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031011", USUARIO: "CI/JULIDIAZ", FECHA: "17/02/2025", BODEGA_DESTINO: "53 NORWING CHITRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031010", USUARIO: "CI/JULIDIAZ", FECHA: "17/02/2025", BODEGA_DESTINO: "53 NORWING CHITRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031009", USUARIO: "CI/JULIDIAZ", FECHA: "17/02/2025", BODEGA_DESTINO: "53 NORWING CHITRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031008", USUARIO: "CI/JULIDIAZ", FECHA: "17/02/2025", BODEGA_DESTINO: "53 NORWING CHITRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031007", USUARIO: "CI/JULIDIAZ", FECHA: "17/02/2025", BODEGA_DESTINO: "53 NORWING CHITRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031006", USUARIO: "CI/JULIDIAZ", FECHA: "17/02/2025", BODEGA_DESTINO: "53 NORWING CHITRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000030985", USUARIO: "XJULIDIAZ", FECHA: "15/02/2025", BODEGA_DESTINO: "52 NORWING DAVID", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000030981", USUARIO: "XJULIDIAZ", FECHA: "15/02/2025", BODEGA_DESTINO: "52 NORWING DAVID", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000030980", USUARIO: "XJULIDIAZ", FECHA: "15/02/2025", BODEGA_DESTINO: "52 NORWING DAVID", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000030979", USUARIO: "XJULIDIAZ", FECHA: "15/02/2025", BODEGA_DESTINO: "52 NORWING DAVID", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000030978", USUARIO: "XJULIDIAZ", FECHA: "15/02/2025", BODEGA_DESTINO: "52 NORWING DAVID", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000030977", USUARIO: "XJULIDIAZ", FECHA: "15/02/2025", BODEGA_DESTINO: "52 NORWING DAVID", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000030976", USUARIO: "XJULIDIAZ", FECHA: "15/02/2025", BODEGA_DESTINO: "52 NORWING DAVID", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000030973", USUARIO: "XJULIDIAZ", FECHA: "15/02/2025", BODEGA_DESTINO: "52 NORWING DAVID", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000030972", USUARIO: "XJULIDIAZ", FECHA: "17/02/2025", BODEGA_DESTINO: "55 NORWING SANTIAGO", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000030943", USUARIO: "CI/JULIDIAZ", FECHA: "15/02/2025", BODEGA_DESTINO: "52 NORWING DAVID", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000030930", USUARIO: "CI/JULIDIAZ", FECHA: "14/02/2025", BODEGA_DESTINO: "01 BREMEN SANTIAGO", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000030929", USUARIO: "CI/JULIDIAZ", FECHA: "14/02/2025", BODEGA_DESTINO: "55 NORWING SANTIAGO", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000030928", USUARIO: "CI/JULIDIAZ", FECHA: "14/02/2025", BODEGA_DESTINO: "55 NORWING SANTIAGO", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000030570", USUARIO: "CI/JULIDIAZ", FECHA: "03/02/2025", BODEGA_DESTINO: "55 NORWING SANTIAGO", BODEGA: "B-81" }
// ];

var paquetesCreadosArray = [];

document.addEventListener("DOMContentLoaded", function () {
  console.log("Consulta de creaci√≥n de Paquetes DOM cargado...");
  let documento = document.getElementById("documento");
  documento.textContent = localStorage.getItem("ConsecutivoPaquete");

  cargarParametros();
});
function cargarParametros() {
  mostrarLoader();
  const parametros = localStorage.getItem("parametrosBusquedaPaquete");
  if (parametros) {
    const params = new URLSearchParams(parametros);
    const pSistema = params.get("pSistema") ?? "";
    const pUsuario = params.get("pUsuario") ?? "";
    const pOpcion = "D";
    const fechaIni = params.get("fechaIni") ?? "";
    const fechaFin = params.get("fechaFin") ?? "";
    const BodegaOrigen = params.get("BodegaOrigen") ?? "";
    const Aplicacion = localStorage.getItem("ConsecutivoPaquete");

    const para =
      "?pSistema=" +
      pSistema +
      "&pUsuario=" +
      pUsuario +
      "&pOpcion=" +
      pOpcion +
      "&fechaIni=" +
      fechaIni +
      "&fechaFin=" +
      fechaFin +
      "&BodegaOrigen=" +
      BodegaOrigen +
      "&Aplicacion=" +
      Aplicacion;
    enviarDatosControlador(para);
  }
}
function enviarDatosControlador(params) {
  fetch(env.API_URL + "busquedadePaquetes" + params, myInit)
    .then((response) => response.json())
    .then((result) => {
      if (result.msg === "SUCCESS") {
        // ocultarLoader();
        paquetesCreadosArray = result.respuesta;
        if (result.respuesta.length != 0) {
          armarTablaResultados(paquetesCreadosArray);
          console.log("REsultados:");
          console.log(paquetesCreadosArray);
        } else {
          // ocultarLoader();
          Swal.fire({
            icon: "info",
            title: "Informaci√≥n",
            text: "No hay registros asignados para el usuario",
            confirmButtonColor: "#28a745",
          });
        }
        document.getElementById("carga").innerHTML = "";
      } else {
        Swal.fire({
          icon: "error",
          title: "error",
          text: "Se registro un error en la aplicaci√≥n",
          confirmButtonColor: "#28a745",
        });
      }
    });
  ocultarLoader();
}
function armarTablaResultados(detallePaquetesEncabezado) {
  const tbody = document.getElementById("tblbodyResultados");
  tbody.innerHTML = "";

  const cantidadDeRegistrosLabel = document.getElementById(
    "cantidadDeRegistros"
  );
  cantidadDeRegistrosLabel.textContent =
    "Cantidad de registros: " + detallePaquetesEncabezado.length;

  detallePaquetesEncabezado.forEach((detalle) => {
    const newRow = document.createElement("tr");
    newRow.innerHTML = `
      <td class="traslado resultados-Tabla"><h5>${detalle.ARTICULO}</h5><br>${detalle.DESCRIPCION}</td>        
      <td class="usertraslado resultados-Tabla">${detalle.CANTIDAD}</td>
      <td class="fecha resultados-Tabla">${detalle.FECHAHORA}</td>  
      <td class="bodegaDestino resultados-Tabla">${detalle.BODEGA_ORIGEN}<br>${detalle.BODEGA_DESTINO}</td>
    `;
    tbody.appendChild(newRow);
  });
}
async function imprimirPaqueteReporte() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF("p", "pt"); // Portrait, puntos

  const marginX = 40;
  const marginY = 40;

  // üßæ Obtener n√∫mero de traslado desde localStorage
  const pPaquete = localStorage.getItem("ConsecutivoPaquete") || "N/D";

  // üìÖ Obtener fecha y hora actual
  const fecha = new Date();
  const fechaStr = fecha.toLocaleDateString("es-ES", {
    year: "numeric",
    month: "2-digit",
    day: "2-digit",
  });
  const horaStr = fecha.toLocaleTimeString("es-ES", {
    hour: "2-digit",
    minute: "2-digit",
  });
  const fechaCompleta = `Fecha: ${fechaStr}  ${horaStr}`;

  // üìÑ Ancho de p√°gina (para centrar texto)
  const pageWidth = doc.internal.pageSize.width;

  // üìÖ Fecha en esquina superior derecha (arriba del t√≠tulo)
  doc.setFont("helvetica", "normal");
  doc.setFontSize(9);
  const fechaWidth = doc.getTextWidth(fechaCompleta);
  doc.text(fechaCompleta, pageWidth - fechaWidth - marginX, marginY - 10);

  // üè¢ Nombre de la empresa (centrado)
  doc.setFont("helvetica", "bold");
  doc.setFontSize(16);
  const empresa = "CENTRAL DE LUBRICANTES";
  const empresaWidth = doc.getTextWidth(empresa);
  doc.text(empresa, (pageWidth - empresaWidth) / 2, marginY + 10);

  // üìò T√≠tulo principal (centrado)
  doc.setFontSize(14);
  const titulo = "REPORTE DE PAQUETES DE TRASLADO";
  const tituloWidth = doc.getTextWidth(titulo);
  doc.text(titulo, (pageWidth - tituloWidth) / 2, marginY + 35);

  // üî¢ Subt√≠tulo: n√∫mero de traslado (centrado)
  doc.setFontSize(12);
  const subtitulo = `N¬∞ de Traslado: ${pPaquete}`;
  const subtituloWidth = doc.getTextWidth(subtitulo);
  doc.text(subtitulo, (pageWidth - subtituloWidth) / 2, marginY + 55);

  // üìä Generar tabla desde HTML
  doc.autoTable({
    html: "#tblResultados",
    startY: marginY + 75,
    styles: { fontSize: 9, halign: "center" },
    headStyles: { fillColor: [63, 81, 181], textColor: [255, 255, 255] },
    alternateRowStyles: { fillColor: [245, 245, 245] },
    margin: { left: marginX, right: marginX },
  });

  // üñãÔ∏è Pie de p√°gina
  const footerText = "Documento generado autom√°ticamente por el sistema WMS";
  doc.setFontSize(9);
  doc.setTextColor(100);
  doc.text(footerText, marginX, doc.internal.pageSize.height - 20);

  // üíæ Guardar con nombre din√°mico (fecha incluida)
  const nombreArchivo = `Reporte_Paquete_${pPaquete}_${fechaStr.replace(
    /\//g,
    "-"
  )}.pdf`;
  doc.save(nombreArchivo);
}
// async function imprimirPaqueteReporte() {
//     let pSistema = "WMS";
//     let pUsuario = document.getElementById('hUsuario').value;
//     // document.getElementById('hUsuario').value;
//     let pTipoConsulta = "L";
//     let pPaquete = localStorage.getItem("ConsecutivoPaquete");

//     const params =
//         "?pSistema=" + pSistema +
//         "&pUsuario=" + pUsuario +
//         "&pTipoConsulta=" + pTipoConsulta +
//         "&pPaquete=" + pPaquete;

//     console.log("Params:\n" + params);

// fetch(env.API_URL + "imprimepaquete" + params, myInit)
//     .then((response) => response.json())
//     .then((result) => {
//     if (result.msg === "SUCCESS" && result.respuesta.length > 0) {
//         console.log("REPORTE CREACION DE PAQUETE", result.respuesta);

//         // Crear PDF (p = portrait / vertical)
//         const { jsPDF } = window.jspdf;
//             const doc = new jsPDF("P", "pt", "a4");
//         // const doc = new jsPDF("landscape", "pt", "a4");

//         // Encabezado
//         doc.setFontSize(16);
//         doc.setFont("helvetica", "bold");
//         doc.text("CREACI√ìN DE PAQUETES", doc.internal.pageSize.getWidth() / 2, 40, { align: "center" });

//         doc.setFontSize(14);
//         doc.setFont("helvetica", "normal");
//         doc.text("PAQUETE: " + pPaquete, doc.internal.pageSize.getWidth() / 2, 60, { align: "center" });

//         doc.setFontSize(12);
//         doc.text("Cami√≥n: " + (result.respuesta[0].REFERENCIA || "N/A"), 40, 90);

//         // Definir columnas (encabezados)
//         const columnas = [
//             "ART√çCULO",
//             "C√ìDIGO\nBARRAS",
//             "CANT\nSOLI",
//             "CANT\nPREP.",
//             "CANT\nVERIF.",
//             "CONSECUTIVO\nPaquete",
//             "FECHA\nCREACI√ìN"
//         ];

//         // Mapear los datos a filas
//         const filas = result.respuesta.map(item => [
//             `${item.articulo}\n${item.descripcion}`,
//             item.Codigo_Barra,
//             item.LineaConsecutivo,
//             item.LineaAprobada,
//             item.LineaVerificada,
//             item.Paquete,
//             item.Fecha_Aplicacion
//         ]);

//                 // Generar tabla debajo del encabezado
//                     doc.autoTable({
//                     head: [columnas],
//                     body: filas,
//                     startY: 140,
//                     styles: { fontSize: 8, cellWidth: "wrap" },
//                     headStyles: { fillColor: [40, 167, 69] },
//                     tableWidth: "auto",
//                     columnStyles: {0: { cellWidth: 120 },}
//                     });

//             console.log("Se gener√≥ el pdf");

// // Descargar PDF
//        doc.save("Reporte_Paquete_" + pPaquete + ".pdf");

//     } else {
//         console.log("El API no devolvi√≥ nada");
//     }
// });
// }
function limpiarResultadoGeneral() {
  const tabla = document.getElementById("tblResultados");
  const resultadoPaginador = document.getElementById("resultadoPaginador");
  const totalRegistros = document.getElementById("cantidadDeRegistros");

  // Limpiar el contenido del paginador si existe
  if (resultadoPaginador) {
    resultadoPaginador.innerHTML = "";
  }

  // Limpiar el contenido de totalRegistros si existe
  if (totalRegistros) {
    totalRegistros.innerHTML = "";
  }

  // Limpiar el contenido del tbody de la tabla si la tabla existe
  if (tabla) {
    let tbody = tabla.querySelector("tbody");
    if (tbody) {
      tbody.innerHTML = "";
    }
  }
  localStorage.removeItem("SearchParameterFlag");
  localStorage.removeItem("parametrosBusquedaPaquete");
}

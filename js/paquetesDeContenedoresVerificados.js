// var paquetesCreadosArray = [
//   { TRASLADO: "TRAS81-0000031055", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "06 BREMEN 24 DE DICIEMBRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031053", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "06 BREMEN 24 DE DICIEMBRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031052", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "06 BREMEN 24 DE DICIEMBRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031051", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "06 BREMEN 24 DE DICIEMBRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031050", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "06 BREMEN 24 DE DICIEMBRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031049", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "06 BREMEN 24 DE DICIEMBRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031048", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "06 BREMEN 24 DE DICIEMBRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031047", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "06 BREMEN 24 DE DICIEMBRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031046", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "06 BREMEN 24 DE DICIEMBRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031045", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "06 BREMEN 24 DE DICIEMBRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031044", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "06 BREMEN 24 DE DICIEMBRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031043", USUARIO: "XJULIDIAZ", FECHA: "14/02/2025", BODEGA_DESTINO: "06 BREMEN 24 DE DICIEMBRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031042", USUARIO: "XJULIDIAZ", FECHA: "14/02/2025", BODEGA_DESTINO: "06 BREMEN 24 DE DICIEMBRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031031", USUARIO: "CI/JULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "55 NORWING SANTIAGO", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031030", USUARIO: "CI/JULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "55 NORWING SANTIAGO", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031029", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "55 NORWING SANTIAGO", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031028", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "55 NORWING SANTIAGO", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031027", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "55 NORWING SANTIAGO", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031026", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "55 NORWING SANTIAGO", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031025", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "55 NORWING SANTIAGO", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031024", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "55 NORWING SANTIAGO", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031023", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "55 NORWING SANTIAGO", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031022", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "55 NORWING SANTIAGO", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031017", USUARIO: "XJULIDIAZ", FECHA: "18/02/2025", BODEGA_DESTINO: "53 NORWING CHITRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031015", USUARIO: "XJULIDIAZ", FECHA: "17/02/2025", BODEGA_DESTINO: "53 NORWING CHITRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031014", USUARIO: "CI/JULIDIAZ", FECHA: "17/02/2025", BODEGA_DESTINO: "53 NORWING CHITRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031013", USUARIO: "CI/JULIDIAZ", FECHA: "17/02/2025", BODEGA_DESTINO: "53 NORWING CHITRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031012", USUARIO: "CI/JULIDIAZ", FECHA: "17/02/2025", BODEGA_DESTINO: "53 NORWING CHITRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031011", USUARIO: "CI/JULIDIAZ", FECHA: "17/02/2025", BODEGA_DESTINO: "53 NORWING CHITRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031010", USUARIO: "CI/JULIDIAZ", FECHA: "17/02/2025", BODEGA_DESTINO: "53 NORWING CHITRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031009", USUARIO: "CI/JULIDIAZ", FECHA: "17/02/2025", BODEGA_DESTINO: "53 NORWING CHITRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031008", USUARIO: "CI/JULIDIAZ", FECHA: "17/02/2025", BODEGA_DESTINO: "53 NORWING CHITRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031007", USUARIO: "CI/JULIDIAZ", FECHA: "17/02/2025", BODEGA_DESTINO: "53 NORWING CHITRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000031006", USUARIO: "CI/JULIDIAZ", FECHA: "17/02/2025", BODEGA_DESTINO: "53 NORWING CHITRE", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000030985", USUARIO: "XJULIDIAZ", FECHA: "15/02/2025", BODEGA_DESTINO: "52 NORWING DAVID", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000030981", USUARIO: "XJULIDIAZ", FECHA: "15/02/2025", BODEGA_DESTINO: "52 NORWING DAVID", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000030980", USUARIO: "XJULIDIAZ", FECHA: "15/02/2025", BODEGA_DESTINO: "52 NORWING DAVID", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000030979", USUARIO: "XJULIDIAZ", FECHA: "15/02/2025", BODEGA_DESTINO: "52 NORWING DAVID", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000030978", USUARIO: "XJULIDIAZ", FECHA: "15/02/2025", BODEGA_DESTINO: "52 NORWING DAVID", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000030977", USUARIO: "XJULIDIAZ", FECHA: "15/02/2025", BODEGA_DESTINO: "52 NORWING DAVID", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000030976", USUARIO: "XJULIDIAZ", FECHA: "15/02/2025", BODEGA_DESTINO: "52 NORWING DAVID", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000030973", USUARIO: "XJULIDIAZ", FECHA: "15/02/2025", BODEGA_DESTINO: "52 NORWING DAVID", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000030972", USUARIO: "XJULIDIAZ", FECHA: "17/02/2025", BODEGA_DESTINO: "55 NORWING SANTIAGO", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000030943", USUARIO: "CI/JULIDIAZ", FECHA: "15/02/2025", BODEGA_DESTINO: "52 NORWING DAVID", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000030930", USUARIO: "CI/JULIDIAZ", FECHA: "14/02/2025", BODEGA_DESTINO: "01 BREMEN SANTIAGO", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000030929", USUARIO: "CI/JULIDIAZ", FECHA: "14/02/2025", BODEGA_DESTINO: "55 NORWING SANTIAGO", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000030928", USUARIO: "CI/JULIDIAZ", FECHA: "14/02/2025", BODEGA_DESTINO: "55 NORWING SANTIAGO", BODEGA: "B-81" },
//   { TRASLADO: "TRAS81-0000030570", USUARIO: "CI/JULIDIAZ", FECHA: "03/02/2025", BODEGA_DESTINO: "55 NORWING SANTIAGO", BODEGA: "B-81" }
// ];

var paquetesCreadosArray = [];

document.addEventListener("DOMContentLoaded", function () {
  //console.log("Consulta de creación de Paquetes DOM cargado...");
  const parametrosBusqueda = localStorage.getItem("parametrosBusquedaPaquete");
  if (parametrosBusqueda) {
    const params = new URLSearchParams(parametrosBusqueda);
    const pSistema = params.get("pSistema") ?? "";
    const pUsuario = params.get("pUsuario") ?? "";
    const pOpcion = params.get("pOpcion") ?? "";
    const fechaIni = params.get("fechaIni") ?? "";
    const fechaFin = params.get("fechaFin") ?? "";
    const BodegaOrigen = params.get("BodegaOrigen") ?? "";
    const Aplicacion = params.get("Aplicacion") ?? "";

    const para =
      "?pSistema=" +
      pSistema +
      "&pUsuario=" +
      pUsuario +
      "&pOpcion=" +
      pOpcion +
      "&fechaIni=" +
      fechaIni +
      "&fechaFin=" +
      fechaFin +
      "&BodegaOrigen=" +
      BodegaOrigen +
      "&Aplicacion=" +
      Aplicacion;
    enviarDatosControlador(para);
  }

  cargarBodegas();
});
function cargarParametros() {
  mostrarLoader();
  let pSistema = "WMS";
  let pUsuario = document.getElementById("hUsuario").value;
  let pOpcion = "R";
  let fechaIni = $("#fecha_ini").val();
  let fechaFin = $("#fecha_fin").val();
  let BodegaOrigen = document.getElementById("bodega").value;
  let Aplicacion = $("#Aplicacion").val() ? $("#Aplicacion").val().trim() : "";

  const params =
    "?pSistema=" +
    pSistema +
    "&pUsuario=" +
    pUsuario +
    "&pOpcion=" +
    pOpcion +
    "&fechaIni=" +
    fechaIni +
    "&fechaFin=" +
    fechaFin +
    "&BodegaOrigen=" +
    BodegaOrigen +
    "&Aplicacion=" +
    Aplicacion;
  enviarDatosControlador(params);
}
function enviarDatosControlador(params) {
  //console.log('BUSQUEDA Paquete PARAMETROS\n '+params);
  localStorage.setItem("parametrosBusquedaPaquete", params);

  fetch(env.API_URL + "busquedadePaquetes" + params, myInit)
    .then((response) => response.json())
    .then((result) => {
      if (result.msg === "SUCCESS") {
        // ocultarLoader();
        paquetesCreadosArray = result.respuesta;
        if (result.respuesta.length != 0) {
          armarTablaResultados(paquetesCreadosArray);
          //console.log('REsultados:');
          //console.log(paquetesCreadosArray);
        } else {
          // ocultarLoader();
          Swal.fire({
            icon: "info",
            title: "Información",
            text: "No hay registros asignados para el usuario",
            confirmButtonColor: "#28a745",
          });
        }
        document.getElementById("carga").innerHTML = "";
      } else {
        Swal.fire({
          icon: "error",
          title: "error",
          text: "Se registro un error en la aplicación",
          confirmButtonColor: "#28a745",
        });
      }
    });
  ocultarLoader();
}
function cargarBodegas() {
  fetch(env.API_URL + "wmsmostarbodegasconsultaordencompra")
    .then((response) => response.json())
    .then((data) => {
      const bodegasSelect = document.getElementById("bodegaSelectPack");
      if (data.respuesta && Array.isArray(data.respuesta)) {
        // Limpiar las opciones existentes
        bodegasSelect.innerHTML =
          '<option value="" disabled selected>Seleccione una bodega</option>';

        // Agregar opciones nuevas
        data.respuesta.forEach((bodega) => {
          const option = document.createElement("option");
          option.value = bodega.BODEGA;
          option.textContent = bodega.NOMBRE;
          bodegasSelect.appendChild(option);
        });

        // Re-inicializar el select para aplicar los cambios
        M.FormSelect.init(bodegasSelect);
      } else {
        console.error("No se encontraron bodegas.");
      }
    })
    .catch((error) => console.error("Error al cargar las bodegas:", error));
}
function armarTablaResultados(detallePaquetesEncabezado) {
  const tbody = document.getElementById("tblbodyResultados");
  tbody.innerHTML = "";

  const cantidadDeRegistrosLabel = document.getElementById(
    "cantidadDeRegistros"
  );
  cantidadDeRegistrosLabel.textContent =
    "Cantidad de registros: " + detallePaquetesEncabezado.length;

  detallePaquetesEncabezado.forEach((detalle) => {
    const newRow = document.createElement("tr");
    newRow.addEventListener("click", () => {
      const Aplicacion = detalle.TRASLADO;
      irAlDetalle(Aplicacion);
    });

    newRow.innerHTML = `
      <td class="traslado resultados-Tabla">${detalle.TRASLADO}</td>        
      <td class="usertraslado resultados-Tabla">${detalle.USUARIO}</td>
      <td class="fecha resultados-Tabla">${detalle.FECHA}</td>  
      <td class="bodegaDestino resultados-Tabla">${detalle.BODEGA_DESTINO}</td>
    `;

    tbody.appendChild(newRow);
  });
}
function irAlDetalle(Aplicacion) {
  localStorage.setItem("ConsecutivoPaquete", Aplicacion);
  window.location.href = "detalle_paquete.html";
}
function limpiarResultadoGeneral() {
  const tabla = document.getElementById("tblResultados");
  const resultadoPaginador = document.getElementById("resultadoPaginador");
  const totalRegistros = document.getElementById("cantidadDeRegistros");
  const bodegaDestino = document.getElementById("bodegaSelectPack");

  // Limpiar el contenido del paginador si existe
  if (resultadoPaginador) {
    resultadoPaginador.innerHTML = "";
  }

  if (bodegaDestino) {
    bodegaDestino.innerHTML = "";
  }
  // Limpiar el contenido de totalRegistros si existe
  if (totalRegistros) {
    totalRegistros.innerHTML = "";
  }

  // Limpiar el contenido del tbody de la tabla si la tabla existe
  if (tabla) {
    let tbody = tabla.querySelector("tbody");
    if (tbody) {
      tbody.innerHTML = "";
    }
  }
  localStorage.removeItem("SearchParameterFlag");
  localStorage.removeItem("parametrosBusquedaPaquete");
}
